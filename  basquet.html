<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BASKET STARS: REAL BOARDS</title>
    <style>
        body { background: #1a1a1a; color: #fff; text-align: center; font-family: 'Arial Black', sans-serif; margin: 0; overflow: hidden; }
        .header { background: linear-gradient(to bottom, #444, #111); padding: 15px; border-bottom: 4px solid #ffeb3b; }
        canvas { background: #2c3e50; border: 6px solid #ecf0f1; display: none; margin: 10px auto; border-radius: 15px; }
        .scoreboard { display: none; font-size: 50px; color: #ffeb3b; text-shadow: 4px 4px #000; margin: 10px; }
        
        #menu, #endScreen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); padding: 40px; border: 5px solid #ffeb3b; border-radius: 20px; z-index: 10;
        }
        #endScreen { display: none; }
        button {
            background: #ff9800; border: none; padding: 15px 30px; color: white; 
            font-size: 20px; font-family: 'Arial Black'; cursor: pointer; border-radius: 10px; margin: 10px; transition: 0.3s;
        }
        button:hover { background: #fff; color: #ff9800; transform: scale(1.1); }
    </style>
</head>
<body>

    <div class="header"><h1>üèÄ BASKET STARS: FIX TABLERO üèÄ</h1></div>
    <div class="scoreboard" id="scoreUI"><span id="s1">0</span> - <span id="s2">0</span></div>

    <div id="menu">
        <h2>MODO DE JUEGO</h2>
        <button onclick="startGame(true)">CONTRA IA</button>
        <button onclick="startGame(false)">DUELO 1 VS 1</button>
    </div>

    <div id="endScreen">
        <h1 id="winnerText">GANADOR</h1>
        <button onclick="location.reload()">REINTENTAR</button>
    </div>

    <canvas id="game" width="850" height="480"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        const gravity = 0.5;
        const floorY = 420;
        const winningScore = 11;
        let gameOver = false;
        let isBotMode = true;
        let keys = {};
        let frame = 0;

        let p1 = { x: 120, y: 340, w: 45, h: 80, dy: 0, dx:0, score: 0, color: "#007bff", skin: "#ffdbac", hair: "#4e2c00", hasBall: true, isDunking: false, stun: 0, dir: 1 };
        let p2 = { x: 680, y: 340, w: 45, h: 80, dy: 0, dx:0, score: 0, color: "#dc3545", skin: "#8d5524", hair: "#000", hasBall: false, isDunking: false, stun: 0, dir: -1 };
        let ball = { x: 425, y: 150, r: 12, dx: 0, dy: 0, owner: p1 };

        // Configuraci√≥n de Canastas y Tableros
        const hoops = [
            { x: 40, y: 220, w: 55, h: 10, side: 'left', boardX: 30, boardY: 130, boardW: 10, boardH: 100 },
            { x: 755, y: 220, w: 55, h: 10, side: 'right', boardX: 810, boardY: 130, boardW: 10, boardH: 100 }
        ];

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function startGame(bot) {
            isBotMode = bot;
            document.getElementById("menu").style.display = "none";
            document.getElementById("scoreUI").style.display = "block";
            canvas.style.display = "block";
            update();
        }

        function drawWorld() {
            // Piso
            ctx.fillStyle = "#d35400"; ctx.fillRect(0, floorY, canvas.width, 60);
            
            hoops.forEach(h => {
                // Dibujar Tablero (Cristal)
                ctx.strokeStyle = "white"; ctx.lineWidth = 4;
                ctx.strokeRect(h.boardX, h.boardY, h.boardW, h.boardH);
                ctx.fillStyle = "rgba(255, 255, 255, 0.2)";
                ctx.fillRect(h.boardX, h.boardY, h.boardW, h.boardH);

                // Dibujar Aro de Metal
                let grad = ctx.createLinearGradient(h.x, h.y, h.x, h.y + h.h);
                grad.addColorStop(0, "#bdc3c7"); grad.addColorStop(1, "#2c3e50");
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.roundRect(h.x, h.y, h.w, h.h, 5); ctx.fill();
                
                // Brillo del metal
                ctx.strokeStyle = "white"; ctx.lineWidth = 1;
                ctx.strokeRect(h.x + 2, h.y + 2, h.w - 4, 2);
            });
        }

        function drawPlayer(p) {
            ctx.save();
            ctx.translate(p.x + p.w / 2, p.y + p.h / 2);
            let moveAnim = (Math.abs(p.dx) > 0) ? Math.sin(frame * 0.15) * 5 : 0;
            if (p.stun > 0) ctx.globalAlpha = 0.5;
            ctx.rotate(p.dir * 0.05);
            ctx.fillStyle = "#fff"; ctx.fillRect(-15, 35 + moveAnim, 12, 8); ctx.fillRect(5, 35 - moveAnim, 12, 8);
            ctx.strokeStyle = p.skin; ctx.lineWidth = 8;
            ctx.beginPath(); ctx.moveTo(-10, 20); ctx.lineTo(-10, 35 + moveAnim); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(10, 20); ctx.lineTo(10, 35 - moveAnim); ctx.stroke();
            ctx.fillStyle = p.color; ctx.fillRect(-18, -15, 36, 40);
            ctx.fillStyle = p.hair; ctx.beginPath(); ctx.arc(0, -40, 18, Math.PI, 0); ctx.fill();
            ctx.fillStyle = p.skin; ctx.beginPath(); ctx.arc(0, -35, 16, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#000"; ctx.fillRect(p.dir * 6, -40, 4, 4);
            ctx.restore();
        }

        function update() {
            if (gameOver) return;
            frame++;
            if (p1.stun > 0) p1.stun--; if (p2.stun > 0) p2.stun--;

            // Movimiento P1
            p1.dx = 0;
            if (keys['KeyA']) { p1.x -= 6; p1.dir = -1; p1.dx = -6; }
            if (keys['KeyD']) { p1.x += 6; p1.dir = 1; p1.dx = 6; }
            if (keys['KeyW'] && p1.y >= floorY - p1.h) p1.dy = -14;

            if (keys['Space']) {
                if (p1.hasBall) shoot(p1);
                else if (Math.hypot(p1.x - p2.x, p1.y - p2.y) < 70) steal(p1, p2);
                keys['Space'] = false;
            }

            // L√≥gica P2 (IA o Humano)
            p2.dx = 0;
            if (isBotMode) {
                let targetX = ball.owner ? p1.x : ball.x;
                if (p2.x > targetX + 40) { p2.x -= 4.2; p2.dir = -1; p2.dx = -4; }
                else if (p2.x < targetX - 40) { p2.x += 4.2; p2.dir = 1; p2.dx = 4; }
                if (p2.hasBall && p2.x < 350) shoot(p2);
            } else {
                if (keys['ArrowLeft']) { p2.x -= 6; p2.dir = -1; p2.dx = -6; }
                if (keys['ArrowRight']) { p2.x += 6; p2.dir = 1; p2.dx = 6; }
                if (keys['ArrowUp'] && p2.y >= floorY - p2.h) p2.dy = -14;
                if (keys['Enter']) {
                    if (p2.hasBall) shoot(p2);
                    else if (Math.hypot(p1.x - p2.x, p1.y - p2.y) < 70) steal(p2, p1);
                    keys['Enter'] = false;
                }
            }

            // Aplicar Gravedad
            [p1, p2].forEach(p => {
                p.y += p.dy;
                if (p.y < floorY - p.h) p.dy += gravity; else { p.y = floorY - p.h; p.dy = 0; }
                if (p.x < 0) p.x = 0; if (p.x > canvas.width - p.w) p.x = canvas.width - p.w;
            });

            // F√≠sica del Bal√≥n
            if (ball.owner) {
                ball.x = ball.owner.x + (ball.owner.dir === 1 ? 45 : -5);
                ball.y = ball.owner.y + 25;
            } else {
                ball.x += ball.dx; ball.y += ball.dy; ball.dy += gravity;

                // Colisiones con Tablero (FIX)
                hoops.forEach(h => {
                    if (ball.x + ball.r > h.boardX && ball.x - ball.r < h.boardX + h.boardW &&
                        ball.y + ball.r > h.boardY && ball.y - ball.r < h.boardY + h.boardH) {
                        ball.dx *= -0.8;
                        ball.x = (ball.x < h.boardX) ? h.boardX - ball.r : h.boardX + h.boardW + ball.r;
                    }

                    // Encestar
                    if (ball.dy > 0 && ball.y > h.y && ball.y < h.y+15 && ball.x > h.x && ball.x < h.x+h.w) {
                        scorePoint(h.side === 'right' ? p1 : p2);
                    }
                });

                // Rebote Paredes y Suelo
                if (ball.y > floorY - ball.r) { ball.y = floorY - ball.r; ball.dy *= -0.6; ball.dx *= 0.9; }
                if (ball.x < ball.r || ball.x > canvas.width - ball.r) { ball.dx *= -0.8; ball.x = (ball.x < ball.r ? ball.r : canvas.width - ball.r); }
                if (ball.y < ball.r) { ball.y = ball.r; ball.dy *= -0.8; }

                // Recogida
                [p1, p2].forEach(p => {
                    if (p.stun === 0 && Math.hypot(ball.x - (p.x+p.w/2), ball.y - (p.y+p.h/2)) < 45) {
                        ball.owner = p; p.hasBall = true;
                    }
                });
            }

            draw();
            requestAnimationFrame(update);
        }

        function steal(rob, vic) { vic.hasBall = false; vic.stun = 50; ball.owner = null; ball.dy = -5; ball.dx = (rob === p1 ? 5 : -5); }
        function shoot(p) { ball.owner = null; p.hasBall = false; ball.dx = (p === p1 ? 12 : -12); ball.dy = -17; }
        function scorePoint(p) { p.score++; document.getElementById("s1").innerText = p1.score; document.getElementById("s2").innerText = p2.score; if (p.score >= winningScore) endGame(p === p1); else resetPos(); }
        function resetPos() { ball.owner = null; ball.x = 425; ball.y = 150; ball.dx = 0; ball.dy = 0; p1.x = 120; p2.x = 680; p1.hasBall = false; p2.hasBall = false; }
        function endGame(p1Won) { gameOver = true; document.getElementById("endScreen").style.display = "block"; document.getElementById("winnerText").innerText = p1Won ? "¬°VICTORIA!" : "DERROTA"; }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawWorld();
            drawPlayer(p1); drawPlayer(p2);
            ctx.fillStyle = "#ff5722"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = "#000"; ctx.stroke();
        }
    </script>
</body>
</html>